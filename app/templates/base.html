<!DOCTYPE html>
<html lang="ru">
<head>
  <!-- Этот скрипт ДОЛЖЕН БЫТЬ ПЕРВЫМ в <head> -->
  <script>
    // 1. МГНОВЕННО создаём overlay ещё до начала рендера страницы
    (function() {
      const overlay = document.createElement('div');
      overlay.id = 'theme-preloader';
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        pointer-events: none;
      `;
      
      // Определяем тему ДО загрузки контента
      const savedTheme = localStorage.getItem('theme');
      const isDark = savedTheme === 'dark';
      
      // Устанавливаем цвет overlay в соответствии с темой
      overlay.style.backgroundColor = isDark ? '#141e2d' : '#ffffff';
      document.documentElement.classList.toggle('dark', isDark);
      
      document.documentElement.appendChild(overlay);
    })();
  </script>

  <meta charset="UTF-8">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/notifications.css') }}">
  {% block styles %}{% endblock %}


  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {% if title %}
  <title>{{ title }} - ПроОбразование</title>
  {% else %}
  <title>Добро пожаловать!</title>
  {% endif %}
  
  <link rel="icon" id="favicon" href="/static/icon.png" type="image/png">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
</head>
<body style="display: flex; flex-direction: column; min-height: 100vh;">
  <div class="page-transition page-visible" style="flex: 1 0 auto;">
    <header class="header">
      <div class="header-container">
        <div class="logo-container"> 
          <a href="/" class="d-flex align-items-center text-decoration-none">
            <img src="/static/icon.png" alt="ПроОбразование" class="logo" id="siteLogo">
            <span class="logo-text">
              <span class="logo-part1">Про</span><span class="logo-part2">Образование</span>
            </span>
          </a>
        </div>
        <div class="theme-switcher">
          <button id="themeToggle" aria-label="Переключить тему">
            <i class="fas fa-sun"></i>
            <i class="fas fa-moon"></i>
          </button>
        </div>

        <nav class="desktop-nav">
          <ul class="nav nav-pills">
            {% if current_user.is_anonymous %}
            <li class="nav-item"><a href="{{ url_for('login') }}" class="nav-link {% if request.endpoint == 'login' %}active{% endif %}">Войти</a></li>
            {% else %}
            <li class="nav-item"><a href="{{ url_for('index') }}" class="nav-link {% if request.endpoint == 'index' %}active{% endif %}">Главная</a></li>
            <li class="nav-item"><a href="{{ url_for('explore') }}" class="nav-link {% if request.endpoint == 'explore' %}active{% endif %}">Поиск</a></li>
            <li class="nav-item"><a href="{{ url_for('add_page') }}" class="nav-link {% if request.endpoint == 'add_page' %}active{% endif %}">Добавить статью</a></li>
            <li class="nav-item"><a href="{{ url_for('user', username=current_user.username) }}" class="nav-link {% if request.path == '/user/' + current_user.username %}active{% endif %}">Профиль</a></li>
            <li class="nav-item"><a href="{{ url_for('logout') }}" class="nav-link">Выйти</a></li>
            {% endif %}
          </ul>
        </nav>

        <button class="mobile-menu-btn">
          <i class="fas fa-bars"></i>
        </button>
      </div>

      <div class="mobile-nav">
        <div class="mobile-nav-header">
          <span>Меню</span>
          <button class="mobile-nav-close">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <ul class="nav nav-pills flex-column">
          {% if current_user.is_anonymous %}
          <li class="nav-item"><a href="{{ url_for('login') }}" class="nav-link {% if request.endpoint == 'login' %}active{% endif %}">Войти</a></li>
          {% else %}
          <li class="nav-item"><a href="{{ url_for('index') }}" class="nav-link {% if request.endpoint == 'index' %}active{% endif %}">Главная</a></li>
          <li class="nav-item"><a href="{{ url_for('explore') }}" class="nav-link {% if request.endpoint == 'explore' %}active{% endif %}">Поиск</a></li>
          <li class="nav-item"><a href="{{ url_for('add_page') }}" class="nav-link {% if request.endpoint == 'add_page' %}active{% endif %}">Добавить статью</a></li>
          <li class="nav-item"><a href="{{ url_for('user', username=current_user.username) }}" class="nav-link {% if request.path == '/user/' + current_user.username %}active{% endif %}">Профиль</a></li>
          <li class="nav-item"><a href="{{ url_for('logout') }}" class="nav-link">Выйти</a></li>
          {% endif %}
        </ul>
        <div class="mobile-nav-footer">
          <nav class="footer-nav">
            <a href="{{ url_for('privacy_policy') }}" class="nav-link no-border">Политика конфиденциальности</a>
            <a href="{{ url_for('faq') }}" class="nav-link no-border">FAQ</a>
            <a href="{{ url_for('about_us') }}" class="nav-link no-border">О нас</a>
          </nav>
          <p class="copyright">© 2025 Проект «ПроОбразование»</p>
        </div>
      </div>
      <div class="overlay"></div>
    </header>

    <main>
      <div class="container">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
      </div>
    </main>
    {% include "_flash_messages.html" %}
  </div>
  
  <button id="notificationBtn" aria-label="Уведомления">
    <span class="dot"></span>
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
      <path d="M12 2C10.34 2 9 3.34 9 5V6.68C6.72 7.74 5.25 10.04 5.25 12.75V17L4 18.25V19H20V18.25L18.75 17V12.75C18.75 10.04 17.28 7.74 15 6.68V5C15 3.34 13.66 2 12 2Z" fill="currentColor"/>
      <path d="M10 21C10 21.8284 10.6716 22.5 11.5 22.5C12.3284 22.5 13 21.8284 13 21H10Z" fill="currentColor"/>
    </svg>
  </button>

  <footer class="footer" style="flex-shrink: 0;">
    <div class="footer-container">
      <nav class="footer-nav">
        <a href="{{ url_for('index') }}" class="nav-link">Главная</a>
        <a href="{{ url_for('privacy_policy') }}" class="nav-link">Политика конфиденциальности</a>
        <a href="{{ url_for('faq') }}" class="nav-link">FAQ</a>
        <a href="{{ url_for('about_us') }}" class="nav-link">О нас</a>
      </nav>
      <p class="copyright">© 2025 Проект «ПроОбразование»</p>
    </div>
  </footer>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/ru.js"></script>
  <script src="{{ url_for('static', filename='main.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  {{ moment.include_moment() }}
  {{ moment.lang('ru') }}
  
  <script>
    // Проверяем сохранённую тему ДО загрузки страницы
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
  </script>
  
  <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
  <script src="{{ url_for('static', filename='js/mobile-menu.js') }}"></script>
  <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
  <script src="{{ url_for('static', filename='js/page-transitions.js') }}"></script>
  <script src="{{ url_for('static', filename='js/visibility.js') }}"></script>
</body>
</html>